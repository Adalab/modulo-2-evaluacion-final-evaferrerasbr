"use strict";const button=document.querySelector(".js-btn"),resetButton=document.querySelector(".js-reset"),results=document.querySelector(".js-list--results"),favoriteList=document.querySelector(".js-list--favorites");let search="",shows=[],favoriteShows=[],favoriteId=[],savedFavorites=[];function handlerEvent(){shows=[],search=document.querySelector(".js-input").value,""!==search?searchShows():showWarning()}function showWarning(){results.innerHTML="";const e=document.createElement("p"),t=document.createTextNode("¡Tienes que introducir tu búsqueda primero!");e.appendChild(t),e.classList.add("paragraph--warning"),results.appendChild(e)}function searchShows(){fetch("//api.tvmaze.com/search/shows?q="+search).then(e=>e.json()).then(e=>{if(0!==e.length){for(let t=0;t<e.length;t++)shows.push(e[t].show);paintShows(),listenSearch()}else notFound()})}function notFound(){results.innerHTML="";const e=document.createElement("p"),t=document.createTextNode("Lo sentimos, no hemos encontrado lo que buscas. ¡Prueba de nuevo!");e.appendChild(t),e.classList.add("paragraph--notfound"),results.appendChild(e)}function paintShows(){results.innerHTML="";for(let e=0;e<shows.length;e++){const t=document.createElement("li"),s=shows[e].id;t.setAttribute("id",s),t.classList.add("list--item","js-list--item");for(const e of favoriteShows)parseInt(e.id)===s&&t.classList.add("favorite");const o=document.createElement("img");shows[e].image?o.setAttribute("src",shows[e].image.medium):o.setAttribute("src","https://via.placeholder.com/210x295/ffffff/666666/?text=TV"),o.classList.add("img"),t.appendChild(o);const a=document.createElement("h3");a.classList.add("title--show");const n=document.createTextNode(""+shows[e].name);a.appendChild(n),t.appendChild(a),results.appendChild(t)}}function paintFavorite(){favoriteList.innerHTML="";for(let e=0;e<favoriteShows.length;e++){const t=document.createElement("li"),s=document.createElement("img"),o=document.createElement("h3"),a=document.createElement("button"),n=document.createTextNode("X"),i=document.createTextNode(""+favoriteShows[e].name);favoriteList.appendChild(t),t.appendChild(s),t.appendChild(a),t.appendChild(o),a.appendChild(n),o.appendChild(i),t.classList.add("list--item--fav"),o.classList.add("title--show"),s.src=favoriteShows[e].image,s.classList.add("img--fav"),a.classList.add("btn--delete","js-remove"),a.addEventListener("click",removeFavorites),a.setAttribute("data-id",favoriteShows[e].id)}}function removeFavorites(e){const t=parseInt(e.currentTarget.dataset.id);for(let e=0;e<favoriteShows.length;e++)t===parseInt(favoriteShows[e].id)&&favoriteShows.splice([e],1);paintFavorite(),paintShows(),listenSearch()}function getFavorites(e){const t=e.currentTarget,s=t.querySelector(".img"),o={name:t.querySelector("h3").innerHTML,image:s.src,id:e.currentTarget.id},a=parseInt(t.id);favoriteId=favoriteShows.map((function(e){return parseInt(e.id)}));const n=favoriteId.indexOf(a);-1===n?favoriteShows.push(o):favoriteShows.splice(n,1),paintFavorite(),paintShows(),listenSearch(),setLocalStorage()}function listenSearch(){const e=document.querySelectorAll(".js-list--item");for(const t of e)t.addEventListener("click",getFavorites)}function setLocalStorage(){const e=JSON.stringify(favoriteShows);localStorage.setItem("favorites",e)}function getLocalStorage(){const e=localStorage.getItem("favorites");savedFavorites=JSON.parse(e),null!==savedFavorites?(favoriteShows=savedFavorites,paintFavorite(),listenSearch()):handlerEvent()}function resetFavorites(){favoriteShows=[],localStorage.removeItem("favorites"),paintFavorite(),paintShows(),listenSearch()}getLocalStorage(),button.addEventListener("click",handlerEvent),resetButton.addEventListener("click",resetFavorites);