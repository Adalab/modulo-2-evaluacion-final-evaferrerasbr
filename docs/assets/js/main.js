"use strict";const resultsSection=document.querySelector(".js-section--results"),favoriteSection=document.querySelector(".js-section--favorites"),resultsList=document.querySelector(".js-list--results"),favoritesList=document.querySelector(".js-list--favorites"),button=document.querySelector(".js-btn"),buttonReset=document.querySelector(".js-reset");let search="",searchedShows=[],favoriteShows=[],favoriteIdArray=[],savedFavorites=[];function handlerEvent(){search=document.querySelector(".js-input").value,searchedShows=[],""===search?emptySearchMessage():searchShows()}function emptySearchMessage(){resultsList.innerHTML="",resultsSection.innerHTML="";const e=document.createElement("p"),t=document.createTextNode("¡Tienes que introducir tu búsqueda primero!");resultsSection.appendChild(e),e.appendChild(t),e.classList.add("message")}function searchShows(){fetch("//api.tvmaze.com/search/shows?q="+search).then(e=>{if(!e.ok)throw e;return e.json()}).then(e=>{if(0===e.length)notFound();else{for(let t=0;t<e.length;t++)searchedShows.push(e[t].show);paintShows(),listenSearch()}}).catch(e=>{serverError(e)})}function serverError(){resultsList.innerHTML="",resultsSection.innerHTML="";const e=document.createElement("p"),t=document.createTextNode("Lo sentimos, ha ocurrido un error en el servidor. Prueba más tarde");resultsSection.appendChild(e),e.appendChild(t),e.classList.add("message")}function notFound(){resultsList.innerHTML="",resultsSection.innerHTML="";const e=document.createElement("p"),t=document.createTextNode("Lo sentimos, no hemos encontrado lo que buscas. ¡Prueba de nuevo!");resultsSection.appendChild(e),e.appendChild(t),e.classList.add("message")}function paintShows(){resultsList.innerHTML="",resultsSection.innerHTML="";for(let e=0;e<searchedShows.length;e++){const t=document.createElement("li"),s=document.createElement("img"),o=document.createElement("h3"),r=document.createTextNode(""+searchedShows[e].name),a=document.createElement("span");resultsList.appendChild(t),t.appendChild(s),t.appendChild(a),t.appendChild(o),o.appendChild(r),t.setAttribute("id",searchedShows[e].id),a.classList.add("fa","fa-heart-o","heart"),t.classList.add("list--item","js-list--item");for(const t of favoriteShows)parseInt(t.id)===searchedShows[e].id&&(a.classList.add("fa-heart"),a.classList.remove("fa-heart-o"));o.classList.add("title--show"),searchedShows[e].image?s.setAttribute("src",searchedShows[e].image.medium):s.setAttribute("src","https://via.placeholder.com/210x295/ffffff/666666/?text=TV"),s.classList.add("img")}}function listenSearch(){const e=document.querySelectorAll(".js-list--item");for(const t of e)t.addEventListener("click",getFavorites)}function notFavoritesYet(){const e=document.createElement("p"),t=document.createTextNode("Todavía no tienes ninguna serie favorita");favoriteSection.appendChild(e),e.appendChild(t),e.classList.add("message")}function getFavorites(e){const t=e.currentTarget,s=t.querySelector(".img"),o={name:t.querySelector("h3").innerHTML,image:s.src,id:e.currentTarget.id};favoriteIdArray=favoriteShows.map((function(e){return parseInt(e.id)}));const r=parseInt(t.id),a=favoriteIdArray.indexOf(r);-1===a?favoriteShows.push(o):favoriteShows.splice(a,1),paintFavorite(),0===favoriteShows.length&&notFavoritesYet(),paintShows(),listenSearch(),setLocalStorage()}function paintFavorite(){favoritesList.innerHTML="",favoriteSection.innerHTML="";for(let e=0;e<favoriteShows.length;e++){const t=document.createElement("li"),s=document.createElement("img"),o=document.createElement("h3"),r=document.createElement("button"),a=document.createTextNode("X"),n=document.createTextNode(""+favoriteShows[e].name);favoritesList.appendChild(t),t.appendChild(s),t.appendChild(r),t.appendChild(o),r.appendChild(a),o.appendChild(n),t.classList.add("list--item--fav"),o.classList.add("title--show"),s.src=favoriteShows[e].image,s.classList.add("img--fav"),r.classList.add("btn--delete","js-remove"),r.setAttribute("data-id",favoriteShows[e].id),r.addEventListener("click",removeFavorites)}setLocalStorage()}function removeFavorites(e){for(let t=0;t<favoriteShows.length;t++)parseInt(e.currentTarget.dataset.id)===parseInt(favoriteShows[t].id)&&favoriteShows.splice([t],1);paintFavorite(),0===favoriteShows.length&&notFavoritesYet(),paintShows(),listenSearch()}function setLocalStorage(){const e=JSON.stringify(favoriteShows);localStorage.setItem("favorites",e)}function getLocalStorage(){const e=localStorage.getItem("favorites");savedFavorites=JSON.parse(e),null===savedFavorites||(favoriteShows=savedFavorites,paintFavorite()),listenSearch(),0===favoriteShows.length&&null!==savedFavorites&&(favoritesList.innerHTML="",notFavoritesYet())}function resetFavorites(){favoriteShows=[],localStorage.removeItem("favorites"),paintFavorite(),notFavoritesYet(),paintShows(),listenSearch()}button.addEventListener("click",handlerEvent),buttonReset.addEventListener("click",resetFavorites),notFavoritesYet(),getLocalStorage();